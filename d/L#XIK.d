BEGIN L#XIK

//1ST ENCOUNTER 

CHAIN IF ~Global("L#XIQuest1","GLOBAL",0)~ THEN L#XIK E1.00
@0 
END
IF~~THEN REPLY @1 EXTERN L#XIK E1.01
IF~~THEN REPLY @2 EXTERN L#XIK E1.02

CHAIN L#XIK E1.01
@3
EXTERN L#XIK E1.03

CHAIN L#XIK E1.02
@4
EXTERN L#XIK E1.03

CHAIN L#XIK E1.03
@5
==L#XIK @6
END
IF~~THEN REPLY @7 EXTERN L#XIK E1.04
IF~~THEN REPLY @8 EXTERN L#XIK E1.04
IF~~THEN REPLY @9 EXTERN L#XIK E1.05
IF~~THEN REPLY @10 EXTERN L#XIK E1.04

CHAIN L#XIK E1.04
@11
EXTERN L#XIK E1.06

CHAIN L#XIK E1.05
@12
EXTERN L#XIK E1.06

CHAIN L#XIK E1.06
@13
DO ~MakeGlobal() SetGlobal("L#XIQuest1","GLOBAL",1) MoveBetweenAreas("L#XI04",[550.530],0)~ EXIT

//2ND ENCOUNTER 

CHAIN IF ~Global("L#XIQuest1","GLOBAL",1) AreaCheck("L#XI04")~ THEN L#XIK E2.00
@14 
==L#XIK @15
DO ~SetGlobal("L#XIQuest1","GLOBAL",2) Enemy()~ EXIT

CHAIN IF ~Global("L#XIQuest1","GLOBAL",3) AreaCheck("L#XI04")~ THEN L#XIK E2.20
@16
==L#XIK @17
DO ~SetGlobal("L#XIQuest1","GLOBAL",4) StartCutSceneMode() ClearAllActions() SmallWait(2) CreateVisualEffectObject("SPDIMNDR","L#XIK") Wait(2) EndCutSceneMode() MoveBetweenAreas("L#XI09",[440.360],14)~ EXIT

//3RD ENCOUNTER 

CHAIN IF ~Global("L#XIQuest1","GLOBAL",5) AreaCheck("L#XI09")~ THEN L#XIK E3.00
@18 
==L#XIK @19
DO ~SetGlobal("L#XIQuest1","GLOBAL",6) Enemy()~ EXIT

//3RD ENCOUNTER - p.2 

CHAIN IF ~Global("L#XIQuest1","GLOBAL",7)~ THEN L#XIK E3.20
@20 
END
IF~~THEN REPLY @21 EXTERN L#XIK E3.21
IF~~THEN REPLY @22 EXTERN L#XIK E3.22

CHAIN L#XIK E3.21
@23
END
IF~~THEN REPLY @24 EXTERN L#XIK E3.23
IF~~THEN REPLY @25 EXTERN L#XIK E3.22

CHAIN L#XIK E3.23
@26
END
IF~~THEN REPLY @27 EXTERN L#XIK E3.24
IF~~THEN REPLY @28 EXTERN L#XIK E3.24
IF~~THEN REPLY @29 EXTERN L#XIK E3.22

CHAIN L#XIK E3.24
@30
==L#XIK @31
==L#XIK @32
==L#XIK @33
==L#XIK @34
END
IF~~THEN REPLY @35 EXTERN L#XIK E3.25
IF~~THEN REPLY @36 EXTERN L#XIK E3.22

CHAIN L#XIK E3.25
@37
==L#XIK @38
==L#XIK @39
==L#XIK @40
==L#XIK @41
END
IF~~THEN REPLY @42 EXTERN L#XIK E3.26
IF~~THEN REPLY @43 EXTERN L#XIK E3.22

CHAIN L#XIK E3.26
@44
END
IF~~THEN REPLY @45 EXTERN L#XIK E3.27
IF~~THEN REPLY @46 EXTERN L#XIK E3.28
IF~~THEN REPLY @47 EXTERN L#XIK E3.22

CHAIN L#XIK E3.27
@48
END
IF~~THEN REPLY @49 EXTERN L#XIK E3.29
IF~~THEN REPLY @50 EXTERN L#XIK E3.28
IF~~THEN REPLY @51 EXTERN L#XIK E3.22

CHAIN L#XIK E3.29
@52
==L#XIK @53
DO ~DestroyItem("MIN1HP") ChangeEnemyAlly("L#XIK",NEUTRAL) SetGlobal("L#XIQuest1","GLOBAL",8) SetGlobal("L#XIKJoined","GLOBAL",1) JoinParty() ClearAllActions()~ EXIT

CHAIN L#XIK E3.28
@54
DO ~DestroyItem("MIN1HP") SetGlobal("L#XIQuest1","GLOBAL",8) ChangeEnemyAlly("L#XIK",NEUTRAL) SetGlobal("L#XIKLeft","GLOBAL",1) ClearAllActions() EscapeArea()~ EXIT

CHAIN L#XIK E3.22
@55
DO ~DestroyItem("MIN1HP") ApplySpell(Myself,CLERIC_HEAL) ApplySpell(Myself,WIZARD_MIRROR_IMAGE) SetGlobal("L#XIQuest1","GLOBAL",8) AttackReevaluate(NearestEnemyOf(Myself),30)~ EXIT

BEGIN L#XIKP

CHAIN IF ~Global("L#XIKJoined","GLOBAL",1)~ THEN L#XIKP LEAVE.00
@56
END
IF~~THEN REPLY @57 DO ~SetGlobal("L#LannaJoined","GLOBAL",0)~ EXIT
IF~~THEN REPLY @58 DO ~JoinParty()~ EXIT

CHAIN IF ~Global("L#XIKJoined","GLOBAL",0)~ THEN L#XIKP REJOIN.00
@59
END
IF~~THEN REPLY @60 DO ~SetGlobal("L#LannaJoined","GLOBAL",1) JoinParty()~ EXIT
IF~~THEN REPLY @61 EXIT


